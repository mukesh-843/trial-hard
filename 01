import React, { useState, useEffect } from 'react';

interface JobApplication {
  jobId: string;
  firstName: string;
  lastName: string;
  email: string;
  phone: string;
  address: string;
  college: string;
  currentCompany: string;
  skills: string[];
  experience: string;
  readyToJoin: string;
  resume: File | null;
  coverLetter: string;
}

interface JobPosting {
  id: string;
  title: string;
  type: string;
  location: string;
  experience: string;
  skills: string[];
  description: string;
  requirements: string[];
  responsibilities: string[];
  isActive?: boolean;
  createdDate?: string;
  updatedDate?: string;
}

const Careers: React.FC = () => {
  const [selectedJob, setSelectedJob] = useState<string | null>(null);
  const [showApplicationForm, setShowApplicationForm] = useState(false);
  const [application, setApplication] = useState<JobApplication>({
    jobId: '',
    firstName: '',
    lastName: '',
    email: '',
    phone: '',
    address: '',
    college: '',
    currentCompany: '',
    skills: [],
    experience: '',
    readyToJoin: '',
    resume: null,
    coverLetter: ''
  });

  const [jobPostings, setJobPostings] = useState<JobPosting[]>([]);

  // Load jobs from localStorage (admin managed)
  useEffect(() => {
    const savedJobs = localStorage.getItem('adminJobs');
    if (savedJobs) {
      const allJobs = JSON.parse(savedJobs);
      // Only show active jobs to public
      setJobPostings(allJobs.filter((job: JobPosting) => job.isActive));
    } else {
      // Default jobs if none exist
      const defaultJobs: JobPosting[] = [
        {
          id: 'sde-1',
          title: 'Software Development Engineer - 1',
          type: 'Full-time',
          location: 'Remote / Hybrid',
          experience: '1-3 years',
          skills: ['React', 'TypeScript', 'JavaScript', 'HTML/CSS', 'Git', 'RESTful APIs'],
          description: 'Join our healthcare technology team to build next-generation patient experience solutions using modern web technologies.',
          requirements: [
            "Bachelor's degree in Computer Science or related field",
            '1-3 years of experience in frontend development',
            'Strong proficiency in React and TypeScript',
            'Experience with modern CSS frameworks (Tailwind CSS preferred)',
            'Understanding of responsive web design principles',
            'Knowledge of version control systems (Git)',
            'Good communication and problem-solving skills'
          ],
          responsibilities: [
            'Develop and maintain user-facing healthcare applications',
            'Collaborate with UX/UI designers to implement responsive designs',
            'Write clean, maintainable, and well-documented code',
            'Participate in code reviews and technical discussions',
            'Work with backend teams to integrate APIs',
            'Ensure cross-browser compatibility and performance optimization'
          ]
        },
        {
          id: 'product-manager',
          title: 'Product Manager',
          type: 'Full-time',
          location: 'Remote / Hybrid',
          experience: '3-5 years',
          skills: ['Product Strategy', 'Healthcare Domain', 'Analytics', 'Agile', 'User Research', 'Market Analysis'],
          description: 'Lead product development for our healthcare queue management platform and drive strategic product decisions.',
          requirements: [
            "Bachelor's/Master's degree in Business, Engineering, or related field",
            '3-5 years of product management experience',
            'Healthcare technology experience preferred',
            'Strong analytical and data-driven decision making skills',
            'Experience with Agile development methodologies',
            'Excellent communication and leadership skills',
            'Understanding of healthcare workflows and patient experience'
          ],
          responsibilities: [
            'Define product roadmap and strategy for healthcare solutions',
            'Gather and prioritize product requirements from stakeholders',
            'Work closely with engineering, design, and business teams',
            'Conduct market research and competitive analysis',
            'Manage product launches and go-to-market strategies',
            'Analyze product metrics and user feedback for continuous improvement'
          ]
        }
      ];
      setJobPostings(defaultJobs);
    }
  }, []);

  const availableSkills = [
    'React', 'TypeScript', 'JavaScript', 'HTML/CSS', '.NET Core', 'C#', 'SQL Server', 
    'Node.js', 'Python', 'Java', 'Angular', 'Vue.js', 'Azure', 'AWS', 'Docker', 
    'Kubernetes', 'Git', 'Agile', 'Scrum', 'Product Strategy', 'Healthcare Domain',
    'Analytics', 'User Research', 'System Design', 'Microservices', 'RESTful APIs',
    'Tailwind CSS', 'Bootstrap', 'SignalR', 'Entity Framework', 'Redis', 'MongoDB'
  ];

  const handleJobSelect = (jobId: string) => {
    setSelectedJob(jobId);
    setShowApplicationForm(true);
    setApplication({ ...application, jobId });
  };

  const handleSkillToggle = (skill: string) => {
    const updatedSkills = application.skills.includes(skill)
      ? application.skills.filter(s => s !== skill)
      : [...application.skills, skill];
    setApplication({ ...application, skills: updatedSkills });
  };

  const handleFileUpload = (e: React.ChangeEvent<HTMLInputElement>) => {
    const file = e.target.files?.[0] || null;
    setApplication({ ...application, resume: file });
  };

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    
    // Create email content
    const emailBody = `
New Job Application Received

Job Position: ${jobPostings.find(job => job.id === application.jobId)?.title}
Application Details:

Personal Information:
- Name: ${application.firstName} ${application.lastName}
- Email: ${application.email}
- Phone: ${application.phone}
- Address: ${application.address}

Professional Background:
- College: ${application.college}
- Current Company: ${application.currentCompany}
- Experience: ${application.experience}
- Skills: ${application.skills.join(', ')}
- Ready to Join: ${application.readyToJoin}

Cover Letter:
${application.coverLetter}

Resume: ${application.resume ? application.resume.name : 'Not provided'}
    `;

    console.log('Application submitted:', application);
    alert('Application submitted successfully! We will review your application and get back to you soon.');
    
    // Reset form
    setApplication({
      jobId: '',
      firstName: '',
      lastName: '',
      email: '',
      phone: '',
      address: '',
      college: '',
      currentCompany: '',
      skills: [],
      experience: '',
      readyToJoin: '',
      resume: null,
      coverLetter: ''
    });
    setShowApplicationForm(false);
    setSelectedJob(null);
  };

  return (
    <div className="min-h-screen bg-gradient-to-br from-blue-50 via-white to-indigo-50">
      {/* Header */}
      <div className="bg-gradient-to-r from-blue-600 to-indigo-700 text-white py-16">
        <div className="max-w-7xl mx-auto px-6 text-center">
          <h1 className="text-4xl md:text-6xl font-bold mb-6">Join Our Team</h1>
          <p className="text-xl md:text-2xl text-blue-100 max-w-3xl mx-auto">
            Help us revolutionize healthcare through innovative technology solutions
          </p>
          <div className="mt-8 inline-block bg-white/10 backdrop-blur-sm rounded-lg px-6 py-3">
            <p className="text-lg font-semibold">Smart Queue Optimizer - Healthcare Technology</p>
          </div>
        </div>
      </div>

      {/* Main Section */}
      <div className="max-w-7xl mx-auto px-6 py-16">
        {!showApplicationForm ? (
          <div>
            {/* Why Work With Us */}
            {/* ... your existing "Why Choose Smart Queue Optimizer?" + Job Listings code here ... */}
          </div>
        ) : (
          <div className="max-w-4xl mx-auto">
            {/* ... application form code here ... */}
          </div>
        )}

        {/* Company Culture Section */}
        {!showApplicationForm && (
          <>
            <div className="mt-16 bg-gradient-to-r from-blue-600 to-indigo-700 text-white rounded-2xl p-12">
              <div className="text-center">
                <h2 className="text-3xl font-bold mb-6">Join the Healthcare Revolution</h2>
                <p className="text-xl text-blue-100 max-w-3xl mx-auto mb-8">
                  Be part of a team that's transforming healthcare delivery through innovative technology solutions. 
                  Work with cutting-edge technologies while making a real impact on patient experiences.
                </p>
                <div className="grid grid-cols-1 md:grid-cols-3 gap-8 text-center">
                  <div>
                    <div className="text-4xl font-bold text-blue-200">500+</div>
                    <div className="text-blue-100">Healthcare Facilities</div>
                  </div>
                  <div>
                    <div className="text-4xl font-bold text-blue-200">70%</div>
                    <div className="text-blue-100">Wait Time Reduction</div>
                  </div>
                  <div>
                    <div className="text-4xl font-bold text-blue-200">24/7</div>
                    <div className="text-blue-100">System Reliability</div>
                  </div>
                </div>
              </div>
            </div>

            {/* Contact Section */}
            <div className="mt-16 bg-gray-50 py-16 rounded-2xl">
              <div className="max-w-4xl mx-auto px-6 text-center">
                <h2 className="text-3xl font-bold text-gray-900 mb-6">Questions About Careers?</h2>
                <p className="text-xl text-gray-600 mb-8">
                  Don't see a position that fits? We're always looking for talented individuals.
                </p>
                <div className="bg-white p-8 rounded-2xl shadow-lg max-w-2xl mx-auto">
                  <p className="text-gray-700 mb-4">
                    Reach out to our HR team for more information about current and future opportunities.
                  </p>
                  <div className="space-y-2">
                    <p className="font-semibold text-gray-900">HR Contact</p>
                    <p className="text-blue-600">gautammukesh935@gmail.com</p>
                    <p className="text-sm text-gray-500">We'll get back to you within 24 hours</p>
                  </div>
                </div>
              </div>
            </div>
          </>
        )}
      </div>
    </div>
  );
};

export default Careers;
